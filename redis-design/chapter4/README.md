# 跳跃表

- 有序数据结构，通过在每个节点中维持多个指向其他节点的指针，从而达到快速访问节点的目的
- 支持平均O(logN)，最坏O(N)复杂度的节点查找，还可以通过顺序性操作来批量处理节点
- Redis只在两个地方用到了跳跃表，一个是实现有序集合键，另一个是在集群节点中用作内部数据结构

## 一、跳跃表节点

跳跃表节点的实现由`redis.h/zskiplistNode`结构定义：

```C

typedef struct zskiplistNode {

    // 层
    struct zskiplistLevel {
        
        // 前进指针
        struct zskiplistNode *forward;
        
        // 跨度
        unsigned int span;
        
    } level[];
    
    // 后退指针
    struct zskiplistNode *backward;
    
    // 成员对象
    robj *obj;

} zskiplistNode;

```

1. 层

    是一个数组，数组中的每个元素都包含一个指向其他节点的指针，程序可以通过这些层来加速访问其他节点的速度。一般来说，层的数量越多，访问其他节点的速度就越快。  
    一个节点的层高，根据幂次定律（越大的数出现的概率越小）随机生成一个介于1和32之间的值作为层高。

2. 前进指针

    每个层都有一个指向表尾方向的前进指针，用于从表头向表尾方向访问节点
    
3. 跨度

    层的跨度用来记录两个节点之间的距离。  
    跨度是用来计算排位的：在查找某个节点的过程中，将沿途访问过的所有层的跨度累计起来，得到的结果就是目标节点在跳跃表中的排位
    
4. 后退指针

    节点的后退指针用于从表尾向表头方向访问节点，因为每个节点只有一个后退指针，所以每次只能后退至前一个节点
    
5. 分值和成员
    
    分值为double类型的浮点数，所有节点按照分值从小到大排序  
    成员对象是一个指针，指向一个字符串对象，而字符串对象则保存着一个SDS值  
    分值相同，则按照成员对象在字典序中的大小排序
    
## 二、跳跃表

`zskiplist`结构定义：

```C

typedef struct zskiplist {
    // 表头节点和表尾节点
    struct zskiplistNode *header, *tail;
    
    // 表中节点的数量
    unsigned long length;
    
    // 表中层数最大的节点的层数
    int level;
    
} zskiplist;

```




