#简单动态字符串

- 简单动态字符串（simple dynamic string，SDS）
- 不使用C自身的字符串，而是重新定义一种数据结构，是为了Redis数据库的安全性、效率、功能考虑

## SDS的定义

```C
struct sdshdr {
 
    // 记录buf数组中已使用字节的数量
    // 等于SDS保存字符串的长度
    int len;
 
    // 记录buf数组中未使用字节的数量
    int free;
 
    // 字节数组，用于保存字符串
    char buf[];
 
};
```

SDS示例如下：


![SDS数据存储示例](../images/jddtzfc/1.png)

## SDS与C字符串的区别

1. 常数复杂度获取字符串长度
    - C字符串获取长度的时间复杂度为O(N)，需要遍历字符串，直到遇到空字符串为止
    - SDS获取长度的时间复杂度为O(1)，直接访问SDS的len属性即可
2. 杜绝缓冲区溢出
    - C字符串不记录自身长度，在拼接字符串时，若原先分配的空间不足存储拼接之后的字符串长度，就会导致缓冲区溢出。
    - SDS自身的空间分配策略杜绝了发生缓冲区溢出的可能性
3. 减少修改字符串时带来的内存重分配次数
    - C字符串在执行增长或缩短字符串的操作时，若忘记进行内存重分配可能会造成缓冲区溢出或内存泄漏
    - SDS空间预分配、惰性空间释放
4. 二进制安全
    - C字符串只能保存文本数据，不能保存图片、音频等
    - SDS可以保存任意格式的二进制数据
5. 兼容部分C字符串函数

| C字符串 | SDS |
| :--- | :--- |
| 获取字符串长度的复杂度为O(N)|获取字符串长度的复杂度为O(1)|
|API是不安全的，可能会造成缓冲区溢出|API是安全的，不会造成缓冲区溢出|
|修改字符串N次必然需要执行N次内存重分配| 修改字符串N次最多需要执行N次内存重分配|
|只能保存文本数据|可以保存文本或者二进制数据|
|可以使用所有<string.h>库中的函数|可以使用一部分<string.h>库中的函数|




